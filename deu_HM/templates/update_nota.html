{% extends 'base.html' %}

{% block content %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<style>
    .button-40 {
  background-color: #111827;
  border: 1px solid transparent;
  border-radius: .75rem;
  box-sizing: border-box;
  color: #FFFFFF;
  cursor: pointer;
  flex: 0 0 auto;
  font-family: "Inter var",ui-sans-serif,system-ui,-apple-system,system-ui,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";
  font-size: 1.125rem;
  font-weight: 600;
  line-height: 1.5rem;
  padding: .75rem 1.2rem;
  text-align: center;
  text-decoration: none #6B7280 solid;
  text-decoration-thickness: auto;
  transition-duration: .2s;
  transition-property: background-color,border-color,color,fill,stroke;
  transition-timing-function: cubic-bezier(.4, 0, 0.2, 1);
  user-select: none;
  -webkit-user-select: none;
  touch-action: manipulation;
  width: auto;
}
</style>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css"
integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
<div class="container">
    <h1 style="padding-top: 20px;"></h1>
    {{ form.media }}
    <form action="" method="post" style="padding-top: 20px;">
        {% csrf_token %}
        <div class="form-group">
            <!-- Titulo -->
            <div class="form-group">
                <div class="form-outline mb-1">
                    <label for="{{ form.titulo.id_for_label }}" class="form-label">Titulo</label>
                    {{ form.titulo }}
                    {% if form.titulo.errors %}
                    <p class="error">{{ form.titulo.errors }}</p>
                    {% endif %}
                </div>
            </div>

            <!-- Cuerpo -->
            <div class="form-group">
                <div class="form-outline mb-1">
                    <label for="{{ form.texto.id_for_label }}" class="form-label">Cuerpo</label>
                    {{ form.texto }}
                    {% if form.texto.errors %}
                    <p class="error">{{ form.texto.errors }}</p>
                    {% endif %}
                </div>
            </div>

            <!-- Ubicacion y fecha de entrevistado -->
            <div class="row">
                <!-- Ubicacion -->
                <div class="col-md-6 mb-1">
                    <div class="form-outline">
                        <label for="{{ form.ubic.id_for_label }}" class="form-label">Ubicacion</label>
                        {{ form.ubic }}
                        {% if form.ubic.errors %}
                        <p class="error">{{ form.ubic.errors }}</p>
                        {% endif %}
                    </div>
                </div>
                <!-- Fecha de entrevistado -->
                <div class="col-md-6 mb-1">
                    <div class="form-outline">
                        <label for="{{ form.fechaEntr.id_for_label }}" class="form-label">Fecha de entrevistado</label>
                        {{ form.fechaEntr }}
                        {% if form.fechaEntr.errors %}
                        <p class="error">{{ form.fechaEntr.errors }}</p>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Entrevista (Boolean) -->
            <div class="form-check mt-2">
                <div class="form-outline mb-1">
                    {{ form.entrevista }}
                    <label for="{{ form.entrevista.id_for_label }}" class="form-label">¿Incluye un entrevistado?</label>
                    {% if form.entrevista.errors %}
                    <p class="error">{{ form.entrevista.errors }}</p>
                    {% endif %}
                </div>
            </div>
            <hr>

            <div id="entrevistado-formset">
                {{ entrevistado_formset.management_form }}
                {% for form in entrevistado_formset %}
                    {{ form.as_table }}
                    <hr>
                {% endfor %}
                <!-- Agrega el campo oculto para user -->
                {{ form.user }}

                <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                    <div class="modal-dialog modal-dialog-centered" role="document">
                      <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel"></h5>
                          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                          </button>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">No</button>
                                <button type="button" id="guardarFormulario" type="submit" class="btn btn-danger">Si</button>
                        </div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <input class="button-40" id="boton-actualizar" data-target="#myModal" data-toggle="modal" value="Actualizar">
            </div>
    </form>


    <script type="text/javascript">
  $(document).ready(function () {
    var campoBooleano = $('#id_entrevista');
    var camposADesactivar = [
      $('#id_fechaEntr'),
      $('#id_entrevistado-0-nombre'), // Ajusta los IDs según la estructura real
      $('#id_entrevistado-0-apellido'), // Ajusta los IDs según la estructura real
      $('#id_entrevistado-0-edad'), // Ajusta los IDs según la estructura real
      $('#id_entrevistado-0-profesion'), // Ajusta los IDs según la estructura real
      $('#id_entrevistado-1-nombre'), // Ajusta los IDs según la estructura real
      $('#id_entrevistado-1-apellido'), // Ajusta los IDs según la estructura real
      $('#id_entrevistado-1-edad'), // Ajusta los IDs según la estructura real
      $('#id_entrevistado-1-profesion'), // Ajusta los IDs según la estructura real
      $('#id_entrevistado-2-nombre'), // Ajusta los IDs según la estructura real
      $('#id_entrevistado-2-apellido'), // Ajusta los IDs según la estructura real
      $('#id_entrevistado-2-edad'), // Ajusta los IDs según la estructura real
      $('#id_entrevistado-2-profesion'), // Ajusta los IDs según la estructura real
      $('#id_entrevistado-0-DELETE'),
      $('#id_entrevistado-1-DELETE'),
      $('#id_entrevistado-2-DELETE'),


    ];

    // Función para habilitar o deshabilitar campos dependiendo del valor del campo booleano
    function controlarCampos() {
      if (campoBooleano.prop('checked')) {
        camposADesactivar.forEach(function(campo) {
          campo.prop('disabled', false);
        });
      } else {
        camposADesactivar.forEach(function(campo) {
          campo.prop('disabled', true);
        });
      }
    }


    // Llamar a la función cuando la página se cargue, cuando el valor del campo booleano cambie
    // y cuando el campo de fecha de entrevistado obtenga el enfoque
    controlarCampos();
    campoBooleano.change(controlarCampos);
    $('#id_fechaEntr').focus(controlarCampos);
  });
</script>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function() {
        $('#guardarFormulario').click(function() {
            // Aquí enviar el formulario cuando se hace clic en el botón "Si"
            $('form').submit(); // Esto enviará el formulario actual
        });
    });
</script>


<script>
    $("#myModal").prependTo("body");
  </script>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
    var abrirModalBtn = document.getElementById('boton-actualizar');
    var modal = document.getElementById('myModal');
    var modalContent = modal.querySelector('.modal-title');

    abrirModalBtn.addEventListener('click', function() {
        // Realizar alguna comprobación o cálculo con JavaScript
        var checkbox = $('#id_entrevistado-0-DELETE');
        if (checkbox.prop('checked')) {
            modalContent.innerHTML = '<h5>Esta eliminando un entrevistado, ¿Esta seguro que desea aplicar los cambios?</h5>';
        } else {
            modalContent.innerHTML = '<h5>¿Esta seguro que desea aplicar los cambios?</h5>';
        }

        modal.style.display = 'block'; // Mostrar el modal
    });
    });
  </script>
  

    {% endblock %}